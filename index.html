<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title> 专住转 - 爪</title>
    <style>
        body { margin: 0; overflow: hidden; background-color: #f0f8ff; font-family: Arial, sans-serif; }
        canvas { display: block; }
        #ui { position: absolute; top: 20px; right: 20px; font-size: 24px; color: #333; pointer-events: none; }
        #gameOver { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); text-align: center; display: none; background: rgba(255, 255, 255, 0.9); padding: 30px; border-radius: 15px; box-shadow: 0 0 20px rgba(0,0,0,0.2); z-index: 10; }
        button { padding: 10px 20px; font-size: 18px; cursor: pointer; background: #4CAF50; color: white; border: none; border-radius: 5px; }
        #textDisplay { position: absolute; top: 100px; left: 50%; transform: translateX(-50%); font-size: 36px; font-weight: bold; color: #2c3e50; text-align: center; pointer-events: none; background: rgba(255, 255, 255, 0.8); padding: 20px; border-radius: 10px; }
        .typed { color: #27ae60; }
        .current { color: #e74c3c; text-decoration: underline; font-size: 42px; }
        .untyped { color: #95a5a6; }
        #keyboard { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); pointer-events: auto; z-index: 5; }
        .key-row { display: flex; justify-content: center; margin: 5px 0; }
        .key { background: white; border: 2px solid #bdc3c7; border-radius: 5px; padding: 10px 15px; margin: 2px; font-size: 18px; min-width: 40px; text-align: center; font-family: Arial, sans-serif; cursor: pointer; transition: all 0.1s; }
        .key:hover { background: #ecf0f1; transform: scale(1.05); }
        .key.active { background: #3498db; color: white; border-color: #2980b9; transform: scale(1.1); }
        #debugToggle { position: absolute; top: 20px; left: 20px; padding: 10px; background: #e74c3c; color: white; border: none; border-radius: 5px; cursor: pointer; font-size: 14px; z-index: 10; }
        #debugToggle.active { background: #27ae60; }
    </style>
</head>
<body>

    <button id="debugToggle" onclick="toggleDebugMode()">爪 拽: OFF</button>
    <div id="ui"> 砖专转: <span id="score">0</span>s | 驻注转: <span id="hitCounter">0</span>/15 | 转: <span id="correctCounter">0</span>/<span id="totalChars">0</span></div>
    
    <div id="textDisplay"></div>
    
    <div id="keyboard">
        <div class="key-row">
            <div class="key" data-key="拽">拽</div>
            <div class="key" data-key="专">专</div>
            <div class="key" data-key=""></div>
            <div class="key" data-key=""></div>
            <div class="key" data-key=""></div>
            <div class="key" data-key=""></div>
            <div class="key" data-key=""></div>
            <div class="key" data-key="驻">驻</div>
        </div>
        <div class="key-row">
            <div class="key" data-key="砖">砖</div>
            <div class="key" data-key=""></div>
            <div class="key" data-key=""></div>
            <div class="key" data-key=""></div>
            <div class="key" data-key="注">注</div>
            <div class="key" data-key=""></div>
            <div class="key" data-key=""></div>
            <div class="key" data-key=""></div>
            <div class="key" data-key=""></div>
            <div class="key" data-key="祝">祝</div>
        </div>
        <div class="key-row">
            <div class="key" data-key=""></div>
            <div class="key" data-key="住">住</div>
            <div class="key" data-key=""></div>
            <div class="key" data-key=""></div>
            <div class="key" data-key=""></div>
            <div class="key" data-key=""></div>
            <div class="key" data-key="爪">爪</div>
            <div class="key" data-key="转">转</div>
            <div class="key" data-key="抓">抓</div>
        </div>
        <div class="key-row">
            <div class="key" data-key=" " style="min-width: 200px;">专</div>
        </div>
    </div>
    
    <div id="gameOver">
        <h1>注 砖 转!</h1>
        <p>爪转 砖专 <span id="finalScore">0</span> 砖转.</p>
        <button onclick="resetGame()">住 砖</button>
    </div>

    <canvas id="gameCanvas"></canvas>

<script>
    const canvas = document.getElementById('gameCanvas');
    const ctx = canvas.getContext('2d');
    const scoreElement = document.getElementById('score');
    const finalScoreElement = document.getElementById('finalScore');
    const gameOverScreen = document.getElementById('gameOver');
    const textDisplay = document.getElementById('textDisplay');

    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;

    let gameActive = true;
    let score = 0;
    let raindrops = [];
    let debugMode = false; // 爪 拽
    let hitCount = 0; // 住驻专 驻注转 砖 驻转
    const maxHits = 10; // 住驻专 驻注转 注 砖  专
    const deathHits = 15; // 住驻专 驻注转 砖专转 转 (专 砖专 )
    
    // 拽住 砖拽
    const songText = "   驻  ";
    const storyText = " 注 砖 Alljobs 拽 住驻转 -Holdin 注砖 砖 专 专祝 专   注 砖专  拽 专转   爪   拽 注转";
    const targetText = songText + storyText;
    let currentIndex = 0;
    let lastCorrectTime = Date.now();
    
    //  驻专 砖  (16 驻专)
    let currentFrame = 0;
    let frameCounter = 0;

    const player = {
        x: canvas.width / 2, // 转 专 住
        y: canvas.height - 150,
        speed: 7,
        moveLeft: false,
        moveRight: false
    };

    const cloud = {
        x: canvas.width / 2 + 300, // 转 300 驻拽住  砖拽
        y: 80,
        targetX: 100, // 注 专爪 注 砖
        moveSpeed: 3 // 专转 转拽专转
    };
    
    let cameraX = 0; // 拽 爪
    
    // 注 转爪转 拽住
    function updateTextDisplay() {
        let html = '';
        for (let i = 0; i < targetText.length; i++) {
            let char = targetText[i];
            let className = '';
            
            // 拽   拽 住驻专 (专 砖专)
            const isStoryPart = i >= songText.length;
            
            if (i < currentIndex) {
                className = 'typed';
                //   拽 住驻专, 爪注 转
                if (isStoryPart) {
                    html += `<span class="${className}" style="color: #e67e22;">${char}</span>`;
                } else {
                    html += `<span class="${className}">${char}</span>`;
                }
            } else if (i === currentIndex) {
                className = 'current';
                if (isStoryPart) {
                    html += `<span class="${className}" style="color: #d35400;">${char}</span>`;
                } else {
                    html += `<span class="${className}">${char}</span>`;
                }
            } else {
                className = 'untyped';
                //   拽 住驻专, 爪 驻专 转专
                if (isStoryPart) {
                    html += `<span class="${className}" style="color: #bdc3c7;">${char}</span>`;
                } else {
                    html += `<span class="${className}">${char}</span>`;
                }
            }
        }
        textDisplay.innerHTML = html;
    }
    
    // 砖转 拽砖 拽转
    function highlightKey(key) {
        document.querySelectorAll('.key').forEach(k => k.classList.remove('active'));
        const keyElement = document.querySelector(`.key[data-key="${key}"]`);
        if (keyElement) {
            keyElement.classList.add('active');
            setTimeout(() => keyElement.classList.remove('active'), 200);
        }
    }

    // 驻拽爪 驻 拽 
    function handleCorrectTyping(key) {
        currentIndex++;
        lastCorrectTime = Date.now();
        updateTextDisplay();
        highlightKey(key);
        
        //  住 转 拽住 - 爪!
        if (currentIndex >= targetText.length) {
            winGame();
        }
    }
    
    window.addEventListener('keydown', (e) => {
        // 拽  爪 注 爪 (砖拽 砖)
        if (e.key === 'ArrowLeft') player.moveLeft = true;
        if (e.key === 'ArrowRight') player.moveRight = true;
        
        // 拽转 拽 
        if (currentIndex < targetText.length) {
            if (debugMode || e.key === targetText[currentIndex]) {
                handleCorrectTyping(e.key);
            }
        }
    });
    
    // 住驻转 拽拽 注 拽转
    document.querySelectorAll('.key').forEach(keyElement => {
        keyElement.addEventListener('click', () => {
            const key = keyElement.getAttribute('data-key');
            if (currentIndex < targetText.length) {
                if (debugMode || key === targetText[currentIndex]) {
                    handleCorrectTyping(key);
                }
            }
        });
    });

    window.addEventListener('keyup', (e) => {
        if (e.key === 'ArrowLeft') player.moveLeft = false;
        if (e.key === 'ArrowRight') player.moveRight = false;
    });

    // 驻拽爪 砖 拽 驻专拽 专 驻 驻专 (0-15)
    function getLegPos(frame, isLeftLeg) {
        //   专 砖,  住 转 爪 专 (8 驻专)
        let f = isLeftLeg ? (frame + 8) % 16 : frame;
        
        // 住爪 砖 注  (X -Y 砖 祝 专 住 祝)
        let angle = (f / 16) * Math.PI * 2;
        return {
            x: Math.sin(angle) * 20,
            y: Math.cos(angle) * 10 + 25 // 专转 专 拽专拽注
        };
    }

    function drawPlayer(x, y) {
        // 砖    - 注 100% 专 10 驻注转
        const bluePercent = Math.min(hitCount / maxHits, 1);
        const fillHeight = 100 * bluePercent; //  转 -100 驻拽住
        
        // 爪专    注
        if (bluePercent > 0) {
            ctx.fillStyle = 'rgba(52, 152, 219, 0.6)';
            ctx.fillRect(x - 30, y + 35 - fillHeight, 90, fillHeight);
        }
        
        ctx.strokeStyle = '#2c3e50';
        ctx.lineCap = 'round';
        ctx.lineJoin = 'round';

        // 拽注转 专转 爪
        let isMoving = player.moveLeft || player.moveRight;
        let animationSpeed = isMoving ? 0.4 : 0.1; // 专 爪注,  注
        
        frameCounter += animationSpeed;
        currentFrame = Math.floor(frameCounter) % 16;

        // --- 爪专 祝 (驻 住拽爪) ---
        
        // 专砖 拽专
        ctx.lineWidth = 5;
        ctx.beginPath();
        ctx.arc(x, y - 60, 18, 0, Math.PI * 2);
        ctx.stroke();

        // 祝
        ctx.lineWidth = 8;
        ctx.beginPath();
        ctx.moveTo(x, y - 45);
        ctx.lineTo(x, y);
        ctx.stroke();

        //  拽驻住
        ctx.lineWidth = 7;
        ctx.beginPath();
        ctx.moveTo(x, y - 35);
        ctx.lineTo(x + 20, y - 35);
        ctx.stroke();
        ctx.lineWidth = 3;
        ctx.strokeRect(x + 20, y - 55, 30, 30);

        // --- 爪专 专 (爪转 16 砖) ---
        ctx.lineWidth = 7;
        [true, false].forEach(isLeft => {
            let pos = getLegPos(currentFrame, isLeft);
            ctx.beginPath();
            ctx.moveTo(x, y); // 驻专拽 专
            
            // 专 (驻爪 专 专住 转专,  住驻转 驻祝 拽)
            let kneeX = x + (pos.x / 2);
            let kneeY = y + 15;
            
            ctx.lineTo(kneeX, kneeY);
            ctx.lineTo(x + pos.x, y + pos.y); // 祝 专
            ctx.stroke();
        });
    }

    function drawCloud(x, y) {
        ctx.fillStyle = '#3498db';
        ctx.beginPath();
        ctx.arc(x, y, 35, 0, Math.PI * 2);
        ctx.arc(x + 45, y, 45, 0, Math.PI * 2);
        ctx.arc(x + 90, y, 35, 0, Math.PI * 2);
        ctx.arc(x + 45, y - 35, 35, 0, Math.PI * 2);
        ctx.fill();
    }

    function update() {
        if (!gameActive) return;

        // 拽  砖 拽  专 (驻转 砖)
        const timeSinceCorrect = Date.now() - lastCorrectTime;
        const isTypingCorrectly = timeSinceCorrect < 500; // 爪 砖  

        // 转注转 砖拽 -  砖 专拽 砖拽 
        let isPlayerMoving = false;
        if (isTypingCorrectly) {
            // 砖拽 , 砖  砖
            player.x -= 8; //  砖
            if (player.x < 50) player.x = 50;
            isPlayerMoving = true;
            
            // 注  住 
            cloud.x += 8; //   (住)
        }
        
        // 转注转 爪 (驻爪)
        if (player.moveLeft && player.x > 50) {
            player.x -= player.speed;
            isPlayerMoving = true;
        }
        if (player.moveRight && player.x < canvas.width - 50) {
            player.x += player.speed;
            isPlayerMoving = true;
        }

        // 注 转拽专 专拽 砖 拽 
        if (!isTypingCorrectly && cloud.x > player.x + 50) {
            cloud.x -= cloud.moveSpeed;
        }

        // 注  住 转 砖拽 - 专拽 驻转!

        // 砖
        if (Math.random() > 0.85) {
            raindrops.push({
                x: cloud.x + Math.random() * 100,
                y: cloud.y + 20,
                speed: 7 + Math.random() * 5
            });
        }

        for (let i = raindrops.length - 1; i >= 0; i--) {
            let r = raindrops[i];
            r.y += r.speed;

            if (r.y > player.y - 70 && r.y < player.y + 40 &&
                r.x > player.x - 25 && r.x < player.x + 60) {
                // 驻注! 住驻 住驻专
                hitCount++;
                raindrops.splice(i, 1); // 住专 转 驻
                
                // 拽  注 住驻专 驻注转 砖专 转
                if (hitCount >= deathHits) {
                    endGame();
                }
                continue;
            }
            if (r.y > canvas.height) raindrops.splice(i, 1);
        }

        score += 1/60;
        scoreElement.innerText = Math.floor(score);
        document.getElementById('hitCounter').innerText = hitCount;
        document.getElementById('correctCounter').innerText = currentIndex;
        document.getElementById('totalChars').innerText = targetText.length;
        
        // 注 拽 爪 注拽 专 砖拽
        cameraX = player.x - canvas.width / 2;
    }

    function draw() {
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        
        // 专爪驻 - 转转 爪
        ctx.strokeStyle = '#bdc3c7';
        ctx.lineWidth = 2;
        ctx.beginPath();
        ctx.moveTo(0, player.y + 35);
        ctx.lineTo(canvas.width, player.y + 35);
        ctx.stroke();

        // 爪专 注 砖拽 注 住 爪
        drawCloud(cloud.x - cameraX, cloud.y);
        drawPlayer(player.x - cameraX, player.y);

        // 砖 - 转 爪
        ctx.strokeStyle = '#3498db';
        ctx.lineWidth = 2;
        raindrops.forEach(r => {
            ctx.beginPath();
            ctx.moveTo(r.x - cameraX, r.y);
            ctx.lineTo(r.x - cameraX, r.y + 12);
            ctx.stroke();
        });

        if (gameActive) {
            requestAnimationFrame(draw);
            update();
        }
    }

    function endGame() {
        gameActive = false;
        gameOverScreen.style.display = 'block';
        finalScoreElement.innerText = Math.floor(score);
    }
    
    function winGame() {
        gameActive = false;
        gameOverScreen.innerHTML = `
            <h1> 爪转! </h1>
            <p>爪转 砖 转 砖专!</p>
            <p>: ${Math.floor(score)} 砖转</p>
            <button onclick="resetGame()">砖拽 砖</button>
        `;
        gameOverScreen.style.display = 'block';
    }
    
    function toggleDebugMode() {
        debugMode = !debugMode;
        const btn = document.getElementById('debugToggle');
        btn.textContent = debugMode ? '爪 拽: ON' : '爪 拽: OFF';
        btn.classList.toggle('active', debugMode);
    }

    function resetGame() {
        gameActive = true;
        score = 0;
        raindrops = [];
        hitCount = 0; // 驻住 驻注转
        player.x = canvas.width / 2; // 专 专 住
        cloud.x = canvas.width / 2 + 300; // 注 专 300 驻拽住  砖拽
        frameCounter = 0;
        currentIndex = 0;
        lastCorrectTime = Date.now();
        gameOverScreen.style.display = 'none';
        gameOverScreen.innerHTML = `
            <h1>注 砖 转!</h1>
            <p>爪转 砖专 <span id="finalScore">0</span> 砖转.</p>
            <button onclick="resetGame()">住 砖</button>
        `;
        updateTextDisplay();
        draw();
    }

    updateTextDisplay();
    draw();
</script>
</body>
</html>
