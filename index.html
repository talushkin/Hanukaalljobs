<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>הליכה ריאליסטית - אנימציה</title>
    <style>
        body { margin: 0; overflow: hidden; background-color: #f0f8ff; font-family: Arial, sans-serif; }
        canvas { display: block; }
        #ui { position: absolute; top: 20px; right: 20px; font-size: 24px; color: #333; pointer-events: none; }
        #gameOver { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); text-align: center; display: none; background: rgba(255, 255, 255, 0.9); padding: 30px; border-radius: 15px; box-shadow: 0 0 20px rgba(0,0,0,0.2); z-index: 10; }
        button { padding: 10px 20px; font-size: 18px; cursor: pointer; background: #4CAF50; color: white; border: none; border-radius: 5px; }
    </style>
</head>
<body>

    <div id="ui">זמן שרדת: <span id="score">0</span>s</div>
    
    <div id="gameOver">
        <h1>הענן השיג אותך!</h1>
        <p>הצלחת לשרוד <span id="finalScore">0</span> שניות.</p>
        <button onclick="resetGame()">נסה שוב</button>
    </div>

    <canvas id="gameCanvas"></canvas>

<script>
    const canvas = document.getElementById('gameCanvas');
    const ctx = canvas.getContext('2d');
    const scoreElement = document.getElementById('score');
    const finalScoreElement = document.getElementById('finalScore');
    const gameOverScreen = document.getElementById('gameOver');

    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;

    let gameActive = true;
    let score = 0;
    let raindrops = [];
    
    // ניהול פריימים של הליכה (16 פריימים)
    let currentFrame = 0;
    let frameCounter = 0;

    const player = {
        x: 100, // מתחיל בצד שמאל
        y: canvas.height - 150,
        speed: 7,
        moveLeft: false,
        moveRight: false
    };

    const cloud = {
        x: canvas.width - 150, // מתחיל בצד ימין
        y: 80,
        targetX: 100, // הענן רוצה להגיע לאיש
        moveSpeed: (canvas.width - 250) / (20 * 60) // מהירות התקרבות - מרחק כולל חלקי 20 שניות (60 פריימים בשנייה)
    };

    window.addEventListener('keydown', (e) => {
        if (e.key === 'ArrowLeft') player.moveLeft = true;
        if (e.key === 'ArrowRight') player.moveRight = true;
    });

    window.addEventListener('keyup', (e) => {
        if (e.key === 'ArrowLeft') player.moveLeft = false;
        if (e.key === 'ArrowRight') player.moveRight = false;
    });

    // פונקציה לחישוב מיקום מפרק הרגל לפי פריים (0-15)
    function getLegPos(frame, isLeftLeg) {
        // אם זו רגל שמאל, אנחנו מסיטים אותה בחצי מחזור (8 פריימים)
        let f = isLeftLeg ? (frame + 8) % 16 : frame;
        
        // סימולציה של מעגל הליכה (X ו-Y של כף הרגל ביחס לגוף)
        let angle = (f / 16) * Math.PI * 2;
        return {
            x: Math.sin(angle) * 20,
            y: Math.cos(angle) * 10 + 25 // הרמת הרגל מהקרקע
        };
    }

    function drawPlayer(x, y) {
        ctx.strokeStyle = '#2c3e50';
        ctx.lineWidth = 4;
        ctx.lineCap = 'round';
        ctx.lineJoin = 'round';

        // קביעת מהירות האנימציה
        let isMoving = player.moveLeft || player.moveRight;
        let animationSpeed = isMoving ? 0.4 : 0.1; // מהר בצעידה, לאט בעמידה
        
        frameCounter += animationSpeed;
        currentFrame = Math.floor(frameCounter) % 16;

        // --- ציור הגוף (לפי הסקיצה) ---
        
        // ראש מקורזל
        ctx.beginPath();
        ctx.arc(x, y - 60, 15, 0, Math.PI * 2);
        ctx.stroke();

        // גוף
        ctx.beginPath();
        ctx.moveTo(x, y - 45);
        ctx.lineTo(x, y);
        ctx.stroke();

        // ידיים וקופסה
        ctx.beginPath();
        ctx.moveTo(x, y - 35);
        ctx.lineTo(x + 20, y - 35);
        ctx.stroke();
        ctx.strokeRect(x + 20, y - 55, 30, 30);

        // --- ציור רגליים (אנימציית 16 שלבים) ---
        
        [true, false].forEach(isLeft => {
            let pos = getLegPos(currentFrame, isLeft);
            ctx.beginPath();
            ctx.moveTo(x, y); // מפרק הירך
            
            // ברך (אופציונלי למראה ריאליסטי יותר, כאן הוספתי כיפוף קל)
            let kneeX = x + (pos.x / 2);
            let kneeY = y + 15;
            
            ctx.lineTo(kneeX, kneeY);
            ctx.lineTo(x + pos.x, y + pos.y); // כף הרגל
            ctx.stroke();
        });
    }

    function drawCloud(x, y) {
        ctx.fillStyle = '#95a5a6';
        ctx.beginPath();
        ctx.arc(x, y, 35, 0, Math.PI * 2);
        ctx.arc(x + 45, y, 45, 0, Math.PI * 2);
        ctx.arc(x + 90, y, 35, 0, Math.PI * 2);
        ctx.arc(x + 45, y - 35, 35, 0, Math.PI * 2);
        ctx.fill();
    }

    function update() {
        if (!gameActive) return;

        // תנועת השחקן
        let isPlayerMoving = false;
        if (player.moveLeft && player.x > 50) {
            player.x -= player.speed;
            isPlayerMoving = true;
        }
        if (player.moveRight && player.x < canvas.width - 50) {
            player.x += player.speed;
            isPlayerMoving = true;
        }

        // תנועת הענן - אם השחקן זז, הענן נע הרבה יותר מהר אחורה (שמאלה)
        if (isPlayerMoving) {
            // כשהשחקן בורח, הענן נסוג מהר לצד ימין
            cloud.x += player.speed * 1.5; // נע פי 1.5 יותר מהר מהשחקן
            if (cloud.x > canvas.width - 100) cloud.x = canvas.width - 100;
        } else {
            // כשהשחקן לא זז, הענן מתקרב לאט
            if (cloud.x > player.x + 50) {
                cloud.x -= cloud.moveSpeed;
            }
        }

        // בדיקה אם הענן הגיע לשחקן
        if (cloud.x < player.x + 150) {
            endGame();
        }

        // גשם
        if (Math.random() > 0.85) {
            raindrops.push({
                x: cloud.x + Math.random() * 100,
                y: cloud.y + 20,
                speed: 7 + Math.random() * 5
            });
        }

        for (let i = raindrops.length - 1; i >= 0; i--) {
            let r = raindrops[i];
            r.y += r.speed;

            if (r.y > player.y - 70 && r.y < player.y + 40 &&
                r.x > player.x - 25 && r.x < player.x + 60) {
                endGame();
            }
            if (r.y > canvas.height) raindrops.splice(i, 1);
        }

        score += 1/60;
        scoreElement.innerText = Math.floor(score);
    }

    function draw() {
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        
        // רצפה
        ctx.strokeStyle = '#bdc3c7';
        ctx.lineWidth = 2;
        ctx.beginPath();
        ctx.moveTo(0, player.y + 35);
        ctx.lineTo(canvas.width, player.y + 35);
        ctx.stroke();

        drawCloud(cloud.x, cloud.y);
        drawPlayer(player.x, player.y);

        // גשם
        ctx.strokeStyle = '#3498db';
        ctx.lineWidth = 2;
        raindrops.forEach(r => {
            ctx.beginPath();
            ctx.moveTo(r.x, r.y);
            ctx.lineTo(r.x, r.y + 12);
            ctx.stroke();
        });

        if (gameActive) {
            requestAnimationFrame(draw);
            update();
        }
    }

    function endGame() {
        gameActive = false;
        gameOverScreen.style.display = 'block';
        finalScoreElement.innerText = Math.floor(score);
    }

    function resetGame() {
        gameActive = true;
        score = 0;
        raindrops = [];
        player.x = 100; // חוזר לצד שמאל
        cloud.x = canvas.width - 150; // הענן חוזר לצד ימין
        frameCounter = 0;
        gameOverScreen.style.display = 'none';
        draw();
    }

    draw();
</script>
</body>
</html>
